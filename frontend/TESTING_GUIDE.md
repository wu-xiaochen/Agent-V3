# 前端功能测试指南

## 🎯 测试准备

1. 打开浏览器控制台（F12 或 Cmd+Option+I）
2. 访问 http://localhost:3000
3. 观察控制台日志，所有操作都会有详细日志输出

## ✅ 测试清单

### 测试 1: New Chat 按钮

**操作步骤**:
1. 点击侧边栏的 "New Chat" 按钮

**期望结果**:
- ✅ 聊天区域清空
- ✅ 会话列表顶部出现新会话，显示 "(新建)" 标识
- ✅ 新会话被高亮显示（带蓝色边框）
- ✅ 控制台输出: `✨ Creating new session: session-xxxxx`
- ✅ 控制台输出: `✅ New session created`

**调试技巧**:
- 查看控制台，确认 sessionId 生成
- 检查 `currentSession` 是否更新
- 确认会话列表中新会话在顶部

---

### 测试 2: 会话切换

**操作步骤**:
1. 点击 "New Chat" 创建几个会话
2. 在每个会话中输入不同的消息
3. 点击不同的会话进行切换

**期望结果**:
- ✅ 点击会话后立即高亮显示
- ✅ 聊天区域清空（因为历史消息未实现）
- ✅ 控制台输出: `🔀 Switching to session: session-xxx from: session-yyy`
- ✅ 控制台输出: `✅ Session switched`
- ✅ 如果点击已激活的会话，控制台输出: `⚠️ Already on this session, skip`

**调试技巧**:
- 观察 `is_active` 状态变化
- 检查是否有重复切换警告
- 确认视觉反馈即时更新

---

### 测试 3: 删除本地会话（新建的会话）

**操作步骤**:
1. 点击 "New Chat" 创建新会话
2. 鼠标悬停在新会话上
3. 点击出现的删除按钮（垃圾桶图标）
4. 在确认对话框中点击"确定"

**期望结果**:
- ✅ 删除按钮在 hover 时显示
- ✅ 会话从列表中消失
- ✅ 控制台输出: `🗑️ Deleting session: session-xxx`
- ✅ 控制台输出: `📌 Deleting local session (not calling backend)`
- ✅ 控制台输出: `✅ Session deleted successfully`
- ✅ 如果删除的是当前会话，自动创建新会话

**调试技巧**:
- 确认是否调用了后端API（不应该调用）
- 检查会话列表是否正确更新
- 确认删除当前会话后是否创建了新会话

---

### 测试 4: 删除后端会话

**操作步骤**:
1. 刷新页面，等待后端会话加载
2. 选择一个后端会话
3. 鼠标悬停并点击删除按钮
4. 确认删除

**期望结果**:
- ✅ 控制台输出: `🗑️ Deleting session: session-xxx`
- ✅ 控制台输出: `🌐 Deleting backend session (calling API)`
- ✅ 会话从列表中消失
- ✅ 控制台输出: `✅ Session deleted successfully`

**调试技巧**:
- 确认后端API被调用
- 检查网络请求（Network标签）
- 确认会话列表重新加载

---

### 测试 5: 删除当前激活的会话

**操作步骤**:
1. 选中任意会话（确保它是激活状态）
2. 删除该会话

**期望结果**:
- ✅ 会话被删除
- ✅ 自动创建新会话
- ✅ 新会话成为激活状态
- ✅ 控制台输出: `🔄 Deleted current session, creating new one`

**调试技巧**:
- 确认新会话立即被高亮
- 检查会话列表更新
- 确认聊天区域清空

---

### 测试 6: 刷新会话列表

**操作步骤**:
1. 点击会话列表顶部的刷新按钮

**期望结果**:
- ✅ 刷新图标旋转动画
- ✅ 控制台输出: `🔄 Refreshing sessions...`
- ✅ 会话列表重新加载
- ✅ 本地会话保留
- ✅ 后端会话更新

**调试技巧**:
- 观察网络请求
- 确认本地会话不丢失
- 检查会话合并逻辑

---

### 测试 7: 消息发送和会话同步

**操作步骤**:
1. 在新会话中输入消息并发送
2. 观察会话列表变化

**期望结果**:
- ✅ 消息出现在聊天区域
- ✅ 消息气泡高度一致（用户和AI）
- ✅ 聊天自动滚动到底部
- ✅ 会话的 `message_count` 应该更新（如果后端实现）

**调试技巧**:
- 检查消息ID生成
- 确认气泡样式
- 测试滚动行为

---

### 测试 8: 视觉反馈

**操作步骤**:
1. 创建多个会话
2. 切换会话并观察视觉变化

**检查项**:
- ✅ 激活会话有蓝色边框（ring-2 ring-primary/20）
- ✅ 激活会话的图标和文字是蓝色
- ✅ 激活会话的文字是粗体
- ✅ 新建会话显示 "(新建)" 标识
- ✅ hover 时删除按钮平滑显示

**调试技巧**:
- 使用浏览器检查元素工具
- 查看CSS类是否正确应用
- 确认颜色和样式符合设计

---

## 🐛 常见问题排查

### 问题 1: New Chat 按钮不工作

**检查**:
1. 控制台是否有错误？
2. 是否输出了 "Creating new session" 日志？
3. `currentSession` 是否更新？

**解决**:
- 检查 `handleNewSession` 函数
- 确认 `setCurrentSession` 被调用
- 验证 `clearMessages` 生效

### 问题 2: 会话切换无响应

**检查**:
1. 是否重复点击了同一会话？
2. 控制台是否输出 "Already on this session"？
3. `currentSession` 是否改变？

**解决**:
- 检查 `handleSelectSession` 函数
- 确认重复检查逻辑
- 验证 useEffect 触发

### 问题 3: 删除按钮不显示

**检查**:
1. CSS 是否正确？
2. group-hover 类是否生效？
3. opacity 过渡是否正常？

**解决**:
- 检查父元素的 `group` 类
- 验证 Tailwind CSS 编译
- 测试不同浏览器

### 问题 4: 删除失败

**检查**:
1. 是本地会话还是后端会话？
2. 控制台报错信息？
3. 网络请求是否成功？

**解决**:
- 检查 `is_local` 标志
- 验证API调用
- 查看后端日志

---

## 📊 性能检查

### 1. 渲染性能

打开 React DevTools Profiler:
1. 记录会话切换操作
2. 检查组件重渲染次数
3. 确保无不必要的重渲染

### 2. 内存泄漏

长时间使用后:
1. 打开 Performance Monitor
2. 观察内存使用
3. 确认无内存泄漏

### 3. 网络请求

打开 Network 标签:
1. 检查API调用频率
2. 确认无重复请求
3. 验证请求/响应正确

---

## ✅ 最终验收

所有以下操作应该流畅无误:

1. [ ] 创建新会话
2. [ ] 切换会话
3. [ ] 删除本地会话
4. [ ] 删除后端会话
5. [ ] 删除当前会话
6. [ ] 刷新会话列表
7. [ ] 发送消息
8. [ ] 滚动聊天记录
9. [ ] 视觉反馈正确
10. [ ] 无控制台错误

如果以上全部通过，前端会话管理功能完成！✨

