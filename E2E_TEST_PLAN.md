# Agent-V3 完整端到端测试计划

## 📋 测试概述

**测试目标**: 验证AI Agent Hub的所有核心功能和用户交互流程
**测试工具**: Playwright MCP
**测试环境**: 
- 前端: http://localhost:3000
- 后端: http://localhost:8000
- 浏览器: Chromium

---

## 🎯 测试模块划分

### 1️⃣ **基础聊天功能 (Chat Functionality)**

#### 1.1 消息发送与接收
- [ ] 发送简单文本消息
- [ ] 接收AI响应
- [ ] 验证消息时间戳显示
- [ ] 验证消息格式化（Markdown渲染）
- [ ] 测试长文本消息处理
- [ ] 测试特殊字符和Emoji

#### 1.2 会话管理 (Session Management)
- [ ] 创建新会话
- [ ] 会话自动命名
- [ ] 切换会话
  - [ ] 切换后消息历史正确加载
  - [ ] 思维链状态正确恢复
  - [ ] 工具状态正确保持
- [ ] 删除会话
- [ ] 重命名会话
- [ ] 会话列表显示与排序
- [ ] 刷新页面后会话持久化验证

#### 1.3 思维链功能 (Thinking Chain)
- [ ] 思维链开始显示（"Thinking..."）
- [ ] 思维链步骤实时更新
- [ ] 思维链步骤展开/折叠
- [ ] 思维链历史记录保存
- [ ] 切换会话后思维链正确显示
- [ ] 思维链时长统计

#### 1.4 工具调用 (Tool Invocation)
- [ ] AI决策调用工具
- [ ] 工具调用参数显示
- [ ] 工具执行状态显示（loading/success/error）
- [ ] 工具执行结果展示
- [ ] 多个工具连续调用
- [ ] 工具调用失败处理
- [ ] 工具调用记录保存

#### 1.5 文件上传
- [ ] 上传PDF文件
- [ ] 上传DOCX文件
- [ ] 上传TXT/MD文件
- [ ] 文件解析状态显示
- [ ] 解析后内容预览
- [ ] 文件内容在对话中引用
- [ ] 上传失败错误提示
- [ ] 文件大小限制验证

#### 1.6 流式输出
- [ ] 响应逐字显示
- [ ] 停止生成功能
- [ ] 流式输出中断恢复
- [ ] 代码块流式渲染
- [ ] 表格流式渲染

---

### 2️⃣ **CrewAI 团队协作功能**

#### 2.1 团队配置生成
- [ ] 通过对话生成团队配置
- [ ] JSON配置解析（支持markdown代码块）
- [ ] 配置验证（agents/tasks必需字段）
- [ ] 配置自动加载到画布
- [ ] 配置保存到本地存储

#### 2.2 Agent配置
- [ ] 添加新Agent
- [ ] 编辑Agent属性
  - [ ] 名称
  - [ ] 角色
  - [ ] 目标
  - [ ] 背景故事
- [ ] 选择Agent工具
  - [ ] 从可用工具列表选择
  - [ ] 工具搜索功能
  - [ ] 工具描述显示
- [ ] 配置Agent LLM模型
- [ ] 删除Agent
- [ ] Agent拖拽排序

#### 2.3 Task配置
- [ ] 添加新Task
- [ ] 编辑Task属性
  - [ ] 描述
  - [ ] 预期输出
  - [ ] 分配Agent
- [ ] Task依赖关系设置
- [ ] 删除Task
- [ ] Task执行顺序调整

#### 2.4 执行流程配置
- [ ] 选择执行模式（Sequential/Hierarchical）
- [ ] Hierarchical模式Manager配置
- [ ] 最大迭代次数设置
- [ ] Temperature参数调整
- [ ] 文件附件上传

#### 2.5 团队执行监控
- [ ] 实时进度显示
- [ ] 执行日志流式输出
- [ ] 日志类型过滤（info/success/error/warning）
- [ ] Agent状态实时更新（idle/working/completed）
- [ ] Task完成状态追踪
- [ ] 执行时长统计
- [ ] 执行错误处理与显示

#### 2.6 结果展示
- [ ] 结果格式化显示
  - [ ] JSON格式高亮
  - [ ] 代码块语法高亮
  - [ ] 纯文本格式化
- [ ] 结果导出
  - [ ] 导出为TXT
  - [ ] 导出为Markdown
- [ ] 结果复制到剪贴板
- [ ] 历史执行记录查看

---

### 3️⃣ **知识库管理功能**

#### 3.1 知识库CRUD
- [ ] 创建知识库
  - [ ] 名称输入
  - [ ] 描述输入
  - [ ] Chunk Size配置
  - [ ] Chunk Overlap配置
- [ ] 列表显示知识库
  - [ ] 卡片视图
  - [ ] 文档数量统计
  - [ ] 创建时间显示
- [ ] 编辑知识库
  - [ ] 修改名称
  - [ ] 修改描述
- [ ] 删除知识库
  - [ ] 确认对话框
  - [ ] 级联删除文档和向量

#### 3.2 文档管理
- [ ] 上传文档到知识库
  - [ ] PDF文档
  - [ ] DOCX文档
  - [ ] TXT/MD文档
- [ ] 文档解析进度显示
- [ ] 文档Embedding进度
- [ ] 文档列表显示
- [ ] 删除文档
- [ ] 文档预览

#### 3.3 知识库搜索
- [ ] 语义搜索功能
- [ ] 搜索结果排序（按相似度）
- [ ] 结果摘要显示
- [ ] 结果来源文档显示
- [ ] 相似度分数显示
- [ ] Top-K参数调整
- [ ] 最小相似度阈值设置

#### 3.4 知识库集成
- [ ] Agent选择关联知识库
- [ ] CrewAI任务中使用知识库
- [ ] 对话中引用知识库内容

---

### 4️⃣ **系统设置功能**

#### 4.1 LLM配置
- [ ] 选择LLM提供商
  - [ ] SiliconFlow
  - [ ] OpenAI
  - [ ] 其他提供商
- [ ] 配置API Key
  - [ ] API Key加密存储
  - [ ] API Key显示脱敏
- [ ] 设置Base URL
- [ ] 选择默认模型
- [ ] Temperature参数配置
- [ ] Max Tokens配置

#### 4.2 配置持久化
- [ ] 保存配置到后端
- [ ] 从后端加载配置
- [ ] 配置重置到默认值
- [ ] 配置验证（必填字段）
- [ ] 保存成功提示
- [ ] 保存失败错误处理

#### 4.3 主题设置
- [ ] 切换到暗色主题
  - [ ] UI元素颜色正确更新
  - [ ] 主题偏好保存到localStorage
- [ ] 切换到亮色主题
  - [ ] UI元素颜色正确更新
  - [ ] 主题偏好保存到localStorage
- [ ] 刷新页面后主题持久化
- [ ] 跟随系统主题

---

### 5️⃣ **工具管理功能**

#### 5.1 工具配置
- [ ] 查看所有可用工具
  - [ ] 工具列表显示
  - [ ] 工具类型分组
  - [ ] 工具描述显示
- [ ] 启用/禁用工具
  - [ ] 切换开关功能
  - [ ] 状态持久化
- [ ] 编辑工具配置
  - [ ] 修改工具参数
  - [ ] 修改工具描述
- [ ] 重置工具配置到默认值

#### 5.2 N8N集成
- [ ] N8N Webhook配置
- [ ] N8N工作流测试
- [ ] N8N工作流列表显示

---

### 6️⃣ **UI/UX 测试**

#### 6.1 响应式设计
- [ ] 桌面视图（1920x1080）
- [ ] 笔记本视图（1366x768）
- [ ] 平板视图（768x1024）
- [ ] 移动视图（375x667）

#### 6.2 交互反馈
- [ ] 按钮悬停效果
- [ ] 加载状态指示器
- [ ] 成功/错误Toast提示
- [ ] 表单验证提示
- [ ] 禁用状态样式

#### 6.3 可访问性
- [ ] 键盘导航
- [ ] 焦点管理
- [ ] ARIA标签
- [ ] 颜色对比度

---

### 7️⃣ **性能测试**

#### 7.1 加载性能
- [ ] 首屏加载时间 (<3s)
- [ ] API响应时间 (<500ms)
- [ ] 大量消息滚动性能
- [ ] 大文件上传性能

#### 7.2 并发测试
- [ ] 多个会话同时运行
- [ ] 多个CrewAI团队同时执行
- [ ] 同时上传多个文件

---

### 8️⃣ **错误处理测试**

#### 8.1 网络错误
- [ ] 后端服务离线
- [ ] API请求超时
- [ ] WebSocket断开重连

#### 8.2 输入验证
- [ ] 空输入处理
- [ ] 超长输入处理
- [ ] 非法字符处理
- [ ] 文件格式验证

#### 8.3 边界条件
- [ ] 会话数量上限
- [ ] 文件大小上限
- [ ] 知识库文档数量上限
- [ ] Token限制处理

---

## 📊 测试执行策略

### 执行顺序
1. **基础功能优先**: Chat → Settings → Tools
2. **高级功能次之**: CrewAI → Knowledge Base
3. **集成测试**: 跨模块功能验证
4. **性能与错误**: 压力测试和异常场景

### 测试数据准备
- 准备测试文档（PDF, DOCX, TXT）
- 准备测试知识库数据
- 准备CrewAI配置模板

### 测试环境要求
- 后端服务正常运行
- 数据库清空/初始化
- 测试用API Key配置

---

## ✅ 通过标准

### 功能性
- 所有核心功能正常工作
- 无阻塞性Bug
- 错误处理完善

### 性能
- 响应时间符合标准
- 无明显卡顿
- 大数据量处理稳定

### 用户体验
- 交互流畅自然
- 错误提示清晰
- 加载状态明确

---

## 📝 测试报告模板

```markdown
# 测试报告

## 测试概览
- 测试日期: YYYY-MM-DD
- 测试人员: [Name]
- 测试版本: v3.1
- 测试环境: [Dev/Staging/Prod]

## 测试结果统计
- 总测试项: X
- 通过: Y
- 失败: Z
- 跳过: W
- 通过率: Y/X * 100%

## 详细测试结果
[按模块列出每个测试项的状态和截图]

## 发现的问题
1. [P0] 阻塞性问题
2. [P1] 严重问题
3. [P2] 一般问题
4. [P3] 优化建议

## 性能数据
- 平均API响应时间: Xms
- 首屏加载时间: Ys
- 内存占用: ZMB

## 建议与总结
[整体评估和改进建议]
```

---

## 🚀 自动化测试脚本

测试脚本将使用Playwright MCP工具，每个模块生成独立的测试截图和日志。

**截图命名规范**: `{module_index}_{test_case}_{status}.png`
- 例: `01_chat_send_message_success.png`

**测试日志**: 记录所有操作步骤、API调用、错误信息

---

## 📌 注意事项

1. **数据隔离**: 每次测试前清理测试数据
2. **并发安全**: 验证多用户/多会话场景
3. **兼容性**: 测试主流浏览器（Chrome, Firefox, Safari）
4. **回归测试**: 修复Bug后重新运行相关测试
5. **CI/CD集成**: 将测试脚本集成到持续集成流程

---

**测试计划版本**: v1.0
**最后更新**: 2025-10-30

