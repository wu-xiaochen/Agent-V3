# è¾“å‡ºæ ¼å¼é…ç½®åŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°

Agent-V3ç°åœ¨æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶çµæ´»æ§åˆ¶è¾“å‡ºæ ¼å¼ï¼Œæ— éœ€ä¿®æ”¹ä»£ç å³å¯åˆ‡æ¢ä¸åŒçš„è¾“å‡ºæ ·å¼ã€‚ç³»ç»Ÿæ”¯æŒä¸‰ç§å†…ç½®æ ¼å¼ï¼ˆnormalã€markdownã€jsonï¼‰ä»¥åŠè‡ªå®šä¹‰æ¨¡æ¿ã€‚

## å®ç°å†…å®¹

### 1. é…ç½®æ–‡ä»¶ä¿®æ”¹

åœ¨ `config/base/services.yaml` ä¸­æ·»åŠ äº†è¾“å‡ºæ ¼å¼é…ç½®ï¼š

```yaml
output:
  format: "normal"  # normal, markdown, json
  options:
    include_metadata: false
    pretty_print: true
    indent: 2
  custom_templates:
    normal: "{response}"
    markdown: "# å“åº”\n\n{response}"
    json: |
      {
        "response": "{response}",
        "timestamp": "{timestamp}",
        "agent": "{agent_name}"
      }
```

### 2. é…ç½®åŠ è½½å™¨å¢å¼º

æ‰©å±•äº† `src/config/config_loader.py`ï¼Œæ·»åŠ äº† `get_output_config()` æ–¹æ³•ï¼Œç”¨äºè·å–è¾“å‡ºæ ¼å¼é…ç½®ã€‚

### 3. è¾“å‡ºæ ¼å¼åŒ–å™¨å®ç°

åˆ›å»ºäº† `src/agent/output_formatter.py`ï¼Œå®ç°äº†ï¼š
- ä¸‰ç§å†…ç½®æ ¼å¼ï¼ˆnormalã€markdownã€jsonï¼‰çš„æ”¯æŒ
- è‡ªå®šä¹‰æ¨¡æ¿æ”¯æŒ
- æ ¼å¼é€‰é¡¹ï¼ˆinclude_metadataã€pretty_printç­‰ï¼‰
- åŠ¨æ€æ ¼å¼åˆ‡æ¢

### 4. UnifiedAgenté›†æˆ

ä¿®æ”¹äº† `src/agent/unified_agent.py`ï¼Œé›†æˆè¾“å‡ºæ ¼å¼åŒ–å™¨ï¼š
- åˆå§‹åŒ–æ—¶åŠ è½½è¾“å‡ºæ ¼å¼é…ç½®
- æä¾› `get_output_format()` å’Œ `set_output_format()` æ–¹æ³•
- åœ¨å“åº”è¿”å›å‰åº”ç”¨æ ¼å¼åŒ–

### 5. ä¸»ç¨‹åºé€‚é…

ä¿®æ”¹äº† `main.py`ï¼Œç¡®ä¿æ­£ç¡®å¤„ç†å’Œæ˜¾ç¤ºæ ¼å¼åŒ–åçš„å“åº”ï¼š
- æ£€æŸ¥å“åº”ç±»å‹ï¼Œæå–æ ¼å¼åŒ–åçš„å†…å®¹
- æµå¼è¾“å‡ºå’Œéæµå¼è¾“å‡ºå‡æ­£ç¡®å¤„ç†

## ä½¿ç”¨æ–¹æ³•

### ä¿®æ”¹é»˜è®¤è¾“å‡ºæ ¼å¼

ç›´æ¥ä¿®æ”¹ `config/base/services.yaml` ä¸­çš„ `format` å­—æ®µï¼š

```yaml
output:
  format: "markdown"  # å°†é»˜è®¤æ ¼å¼æ”¹ä¸ºmarkdown
```

### è‡ªå®šä¹‰æ¨¡æ¿

ä¿®æ”¹ `custom_templates` ä¸­çš„æ¨¡æ¿ï¼š

```yaml
output:
  custom_templates:
    normal: "ğŸ¤– {agent_name} å›ç­”: {response}"
    json: |
      {
        "agent": "{agent_name}",
        "response": "{response}",
        "query": "{query}",
        "timestamp": "{timestamp}"
      }
```

### ä»£ç ä¸­ä½¿ç”¨

```python
from src.agents.unified.unified_agent import UnifiedAgent

# åˆ›å»ºæ™ºèƒ½ä½“ï¼ˆè‡ªåŠ¨ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤æ ¼å¼ï¼‰
agent = UnifiedAgent()

# è·å–å½“å‰è¾“å‡ºæ ¼å¼
current_format = agent.get_output_format()

# åŠ¨æ€åˆ‡æ¢è¾“å‡ºæ ¼å¼
agent.set_output_format("markdown")
response = agent.run("ä½ å¥½")
print(response["response"])
```

## æµ‹è¯•éªŒè¯

### æµ‹è¯•è„šæœ¬

åˆ›å»ºäº†å¤šä¸ªæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

1. `tests/config/test_config_loader.py` - æµ‹è¯•é…ç½®åŠ è½½å™¨
2. `tests/config/test_custom_templates.py` - æµ‹è¯•è‡ªå®šä¹‰æ¨¡æ¿
3. `tests/config/test_output_format_application.py` - æµ‹è¯•è¾“å‡ºæ ¼å¼åº”ç”¨
4. `examples/output_format_example.py` - è¾“å‡ºæ ¼å¼ç¤ºä¾‹è„šæœ¬

### æµ‹è¯•ç»“æœ

æ‰€æœ‰æµ‹è¯•å‡é€šè¿‡ï¼ŒéªŒè¯äº†ï¼š
- é…ç½®æ–‡ä»¶æ­£ç¡®åŠ è½½è¾“å‡ºæ ¼å¼è®¾ç½®
- ä¸‰ç§å†…ç½®æ ¼å¼æ­£å¸¸å·¥ä½œ
- è‡ªå®šä¹‰æ¨¡æ¿æ­£ç¡®åº”ç”¨
- åŠ¨æ€æ ¼å¼åˆ‡æ¢åŠŸèƒ½æ­£å¸¸

## æ–‡æ¡£

åˆ›å»ºäº†è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£ï¼š
- `docs/development/output_format_configuration.md` - è¾“å‡ºæ ¼å¼é…ç½®æŒ‡å—

## ä¼˜åŠ¿

1. **çµæ´»æ€§**ï¼šæ— éœ€ä¿®æ”¹ä»£ç å³å¯åˆ‡æ¢è¾“å‡ºæ ¼å¼
2. **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒè‡ªå®šä¹‰æ¨¡æ¿ï¼Œæ»¡è¶³ç‰¹å®šéœ€æ±‚
3. **ç¯å¢ƒé€‚é…**ï¼šå¯ä¸ºä¸åŒç¯å¢ƒé…ç½®ä¸åŒè¾“å‡ºæ ¼å¼
4. **åŠ¨æ€åˆ‡æ¢**ï¼šæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€æ›´æ”¹è¾“å‡ºæ ¼å¼
5. **å‘åå…¼å®¹**ï¼šä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œå¹³æ»‘å‡çº§

## æ³¨æ„äº‹é¡¹

1. è‡ªå®šä¹‰æ¨¡æ¿ä½¿ç”¨Pythonçš„å­—ç¬¦ä¸²æ ¼å¼åŒ–è¯­æ³•
2. JSONæ¨¡æ¿å¿…é¡»ç”Ÿæˆæœ‰æ•ˆçš„JSONæ ¼å¼
3. ç¯å¢ƒå˜é‡å¯ä»¥è¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®
4. é…ç½®æ–‡ä»¶å¿…é¡»ä½¿ç”¨æœ‰æ•ˆçš„YAMLæ ¼å¼

## åç»­æ‰©å±•

å¯ä»¥è€ƒè™‘çš„åç»­æ‰©å±•ï¼š
1. æ”¯æŒæ›´å¤šå†…ç½®æ ¼å¼ï¼ˆå¦‚XMLã€CSVç­‰ï¼‰
2. æ·»åŠ æ¨¡æ¿éªŒè¯åŠŸèƒ½
3. æ”¯æŒä»å¤–éƒ¨æ–‡ä»¶åŠ è½½æ¨¡æ¿
4. æ·»åŠ è¾“å‡ºæ ¼å¼é¢„è§ˆåŠŸèƒ½