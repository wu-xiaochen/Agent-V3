# Agent-V3 ç³»ç»Ÿæ¶æ„æ–‡æ¡£

## ğŸ“ æ¶æ„æ¦‚è§ˆ

Agent-V3 é‡‡ç”¨**åˆ†å±‚æ¶æ„**å’Œ**é¢†åŸŸé©±åŠ¨è®¾è®¡**ï¼Œä¸“æ³¨äºä¾›åº”é“¾æ™ºèƒ½ä½“ç³»ç»Ÿçš„æ„å»ºå’Œè¿è¡Œã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç”¨æˆ·æ¥å£å±‚                            â”‚
â”‚              (CLI / API / Web Interface)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ™ºèƒ½ä½“å±‚                              â”‚
â”‚         UnifiedAgent  â”‚  SupplyChainAgent                  â”‚
â”‚         (ReAct Architecture + LangChain)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å·¥å…·å’ŒæœåŠ¡å±‚                             â”‚
â”‚  Built-in Tools â”‚ Supply Chain Tools â”‚ Integration Tools  â”‚
â”‚  (Calculator, Search)  â”‚  (Analyzer, Forecasting)         â”‚
â”‚                   â”‚  (CrewAI, n8n)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åŸºç¡€è®¾æ–½å±‚                               â”‚
â”‚  LLM Factory â”‚ Redis Store â”‚ Config Loader â”‚ Formatters   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤–éƒ¨æœåŠ¡å±‚                               â”‚
â”‚  OpenAI/SiliconFlow â”‚ Redis â”‚ n8n â”‚ Search APIs           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ¶æ„è®¾è®¡åŸåˆ™

### 1. åˆ†å±‚æ¶æ„
- **æ¥å£å±‚**ï¼šå¤„ç†ç”¨æˆ·äº¤äº’
- **æ™ºèƒ½ä½“å±‚**ï¼šå®ç°æ™ºèƒ½ä½“é€»è¾‘
- **æœåŠ¡å±‚**ï¼šæä¾›å·¥å…·å’ŒæœåŠ¡
- **åŸºç¡€è®¾æ–½å±‚**ï¼šåº•å±‚æŠ€æœ¯æ”¯æŒ
- **å¤–éƒ¨æœåŠ¡å±‚**ï¼šç¬¬ä¸‰æ–¹é›†æˆ

### 2. é…ç½®é©±åŠ¨
- æ‰€æœ‰é…ç½®å¤–éƒ¨åŒ–
- æ”¯æŒå¤šç¯å¢ƒé…ç½®
- ç¯å¢ƒå˜é‡è¦†ç›–
- é›¶ç¡¬ç¼–ç 

### 3. ä¾èµ–æ³¨å…¥
- æ„é€ å‡½æ•°æ³¨å…¥
- æ¥å£éš”ç¦»
- æ¾è€¦åˆè®¾è®¡

### 4. å¯æµ‹è¯•æ€§
- å•å…ƒæµ‹è¯•è¦†ç›–
- é›†æˆæµ‹è¯•éªŒè¯
- ç«¯åˆ°ç«¯æµ‹è¯•
- Mockå‹å¥½è®¾è®¡

### 5. å¯æ‰©å±•æ€§
- æ’ä»¶å¼å·¥å…·ç³»ç»Ÿ
- åŠ¨æ€åŠ è½½æœºåˆ¶
- æ¨¡å—åŒ–è®¾è®¡
- æ¸…æ™°çš„æ‰©å±•ç‚¹

## ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶

### 1. æ™ºèƒ½ä½“å±‚ (Agents Layer)

#### UnifiedAgent
**èŒè´£**: é€šç”¨æ™ºèƒ½ä½“ï¼Œå¤„ç†å„ç±»ä»»åŠ¡

```python
class UnifiedAgent:
    def __init__(
        self,
        provider: Optional[str] = None,
        memory: bool = True,
        redis_url: Optional[str] = None,
        session_id: Optional[str] = None,
        model_name: Optional[str] = None,
        tools: Optional[List[str]] = None,
        **kwargs
    )
```

**ç‰¹æ€§**:
- ReActæ¶æ„
- å¤šè½®å¯¹è¯è®°å¿†
- å·¥å…·è°ƒç”¨èƒ½åŠ›
- å¯é…ç½®è¾“å‡ºæ ¼å¼
- RedisæŒä¹…åŒ–

**å·¥ä½œæµç¨‹**:
```
ç”¨æˆ·è¾“å…¥ â†’ åŠ è½½é…ç½® â†’ åˆ›å»ºLLM â†’ åŠ è½½å·¥å…· â†’ åˆ›å»ºæ™ºèƒ½ä½“ 
         â†’ ReActæ¨ç† â†’ å·¥å…·è°ƒç”¨ â†’ æ ¼å¼åŒ–è¾“å‡º
```

#### SupplyChainAgent
**èŒè´£**: ä¾›åº”é“¾ä¸“ä¸šæ™ºèƒ½ä½“

**ç‰¹æ€§**:
- ä¾›åº”é“¾é¢†åŸŸçŸ¥è¯†
- ä¸šåŠ¡æµç¨‹è§„åˆ’
- CrewAIé…ç½®ç”Ÿæˆ
- å¤šé˜¶æ®µå¯¹è¯ç®¡ç†

**å¯¹è¯çŠ¶æ€**:
- `éœ€æ±‚æ”¶é›†` â†’ `æ–¹æ¡ˆç”Ÿæˆ` â†’ `æ–¹æ¡ˆç¡®è®¤` â†’ `é…ç½®ç”Ÿæˆ`

### 2. å·¥å…·ç³»ç»Ÿ (Tool System)

#### å·¥å…·åˆ†ç±»

**Built-in Tools** (å†…ç½®å·¥å…·):
- `TimeTool`: è·å–æ—¶é—´
- `SearchTool`: ç½‘ç»œæœç´¢
- `CalculatorTool`: æ•°å­¦è®¡ç®—

**Supply Chain Tools** (ä¾›åº”é“¾å·¥å…·):
- `DataAnalyzerTool`: æ•°æ®åˆ†æ
- `ForecastingTool`: éœ€æ±‚é¢„æµ‹
- `OptimizationTool`: ä¼˜åŒ–å¼•æ“
- `RiskAssessmentTool`: é£é™©è¯„ä¼°

**Integration Tools** (é›†æˆå·¥å…·):
- `CrewAIGeneratorTool`: CrewAIé…ç½®ç”Ÿæˆ
- `CrewAIRuntimeTool`: CrewAIè¿è¡Œæ—¶
- `N8NMCPTool`: n8nå·¥ä½œæµç”Ÿæˆ

#### åŠ¨æ€å·¥å…·åŠ è½½

```python
# config/tools/tools_config.json
{
  "tools": [
    {
      "type": "builtin",
      "name": "calculator",
      "enabled": true
    },
    {
      "type": "mcp_stdio",
      "name": "n8n_mcp_generator",
      "command": "docker",
      "args": ["exec", "n8n-mcp", "node", "dist/mcp/index.js"],
      "enabled": true
    }
  ],
  "agent_tool_mapping": {
    "unified_agent": ["calculator", "search", "n8n_mcp_generator"]
  }
}
```

**åŠ è½½æµç¨‹**:
```
è¯»å–é…ç½® â†’ è§£æå·¥å…·å®šä¹‰ â†’ å®ä¾‹åŒ–å·¥å…· 
        â†’ æ³¨å†Œåˆ°æ™ºèƒ½ä½“ â†’ è¿è¡Œæ—¶è°ƒç”¨
```

### 3. é…ç½®ç³»ç»Ÿ (Configuration System)

#### é…ç½®åˆ†å±‚

```
config/
â”œâ”€â”€ base/                       # åŸºç¡€é…ç½®ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰
â”‚   â”œâ”€â”€ agents.yaml            # æ™ºèƒ½ä½“é…ç½®
â”‚   â”œâ”€â”€ prompts.yaml           # æç¤ºè¯é…ç½®
â”‚   â”œâ”€â”€ services.yaml          # æœåŠ¡é…ç½®
â”‚   â”œâ”€â”€ logging.yaml           # æ—¥å¿—é…ç½®
â”‚   â””â”€â”€ database.yaml          # æ•°æ®åº“é…ç½®
â”œâ”€â”€ environments/              # ç¯å¢ƒé…ç½®ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
â”‚   â”œâ”€â”€ development.yaml
â”‚   â”œâ”€â”€ staging.yaml
â”‚   â””â”€â”€ production.yaml
â””â”€â”€ tools/                     # å·¥å…·é…ç½®
    â””â”€â”€ tools_config.json
```

#### é…ç½®åŠ è½½æµç¨‹

```python
config_loader = ConfigLoader(env="development")
# åŠ è½½é¡ºåºï¼š
# 1. base/*.yaml
# 2. environments/{env}.yaml
# 3. ç¯å¢ƒå˜é‡è¦†ç›–
```

**ä¼˜å…ˆçº§**: ç¯å¢ƒå˜é‡ > ç¯å¢ƒé…ç½® > åŸºç¡€é…ç½®

#### é…ç½®ç¤ºä¾‹

```yaml
# config/base/agents.yaml
agents:
  unified_agent:
    enabled: true
    model: "Pro/deepseek-ai/DeepSeek-V3.1-Terminus"
    system_prompt: "supply_chain_planning"
    parameters:
      temperature: 0.7
      max_tokens: 4000
    tools:
      - calculator
      - search
      - time
      - n8n_mcp_generator
    memory:
      enabled: true
      type: "redis"
```

### 4. å­˜å‚¨å±‚ (Storage Layer)

#### Redis Chat History

**åŠŸèƒ½**:
- å¯¹è¯å†å²æŒä¹…åŒ–
- ä¼šè¯ç®¡ç†
- TTLè‡ªåŠ¨è¿‡æœŸ
- åˆ†å¸ƒå¼æ”¯æŒ

**å®ç°**:
```python
from src.storage.redis_chat_history import RedisChatMessageHistory

history = RedisChatMessageHistory(
    session_id="user123",
    url="redis://localhost:6379/0",
    ttl=3600
)
```

**æ•°æ®ç»“æ„**:
```
Key: agent:chat:{session_id}
Type: List
Value: [
    {"type": "human", "content": "..."},
    {"type": "ai", "content": "..."}
]
TTL: 3600 seconds
```

### 5. LLMå·¥å‚ (LLM Factory)

#### å¤šæä¾›å•†æ”¯æŒ

```python
from src.infrastructure.llm.llm_factory import LLMFactory

# åˆ›å»ºLLMå®ä¾‹
llm = LLMFactory.create_llm(
    provider="siliconflow",
    model_name="deepseek-chat",
    temperature=0.7
)
```

**æ”¯æŒçš„æä¾›å•†**:
- OpenAI (GPT-3.5, GPT-4)
- SiliconFlow (Qwen, DeepSeek)
- Anthropic (Claude)
- HuggingFace (æœ¬åœ°æ¨¡å‹)

**é…ç½®ç¤ºä¾‹**:
```yaml
# config/base/services.yaml
services:
  llm:
    provider: "siliconflow"
    default_model: "deepseek-chat"
    parameters:
      temperature: 0.7
      max_tokens: 4000
    api_keys:
      openai: "${OPENAI_API_KEY}"
      siliconflow: "${SILICONFLOW_API_KEY}"
```

### 6. æç¤ºè¯ç®¡ç† (Prompt Management)

#### æç¤ºè¯é…ç½®

```yaml
# config/base/prompts.yaml
prompts:
  supply_chain_planning:
    name: "ä¾›åº”é“¾ä¸šåŠ¡æµç¨‹è§„åˆ’æç¤ºè¯"
    template: |
      ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ä¾›åº”é“¾ç®¡ç†ä¸“å®¶...
      
      <æ ¸å¿ƒèŒè´£>
      - ç†è§£ç”¨æˆ·éœ€æ±‚
      - ç”Ÿæˆä¸šåŠ¡æµç¨‹è§„åˆ’
      - ä¸ç”¨æˆ·ç¡®è®¤æ–¹æ¡ˆ
      </æ ¸å¿ƒèŒè´£>
      
      <å·¥å…·ä½¿ç”¨æŒ‡å—>
      - ä½¿ç”¨n8n_mcp_generatorç”Ÿæˆå·¥ä½œæµ
      - ä½¿ç”¨crewai_generatorç”Ÿæˆå›¢é˜Ÿé…ç½®
      </å·¥å…·ä½¿ç”¨æŒ‡å—>
```

#### æç¤ºè¯åŠ è½½

```python
from src.prompts.prompt_loader import PromptLoader

loader = PromptLoader()
prompt = loader.get_prompt("supply_chain_planning")
```

## ğŸ”„ æ•°æ®æµ

### å®Œæ•´è¯·æ±‚æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  main.py (å…¥å£)                      â”‚
â”‚  - å‚æ•°è§£æ                          â”‚
â”‚  - æ—¥å¿—åˆå§‹åŒ–                        â”‚
â”‚  - æ™ºèƒ½ä½“åˆ›å»º                        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UnifiedAgent.__init__()             â”‚
â”‚  - åŠ è½½é…ç½® (ConfigLoader)          â”‚
â”‚  - åˆ›å»ºLLM (LLMFactory)             â”‚
â”‚  - åŠ è½½å·¥å…· (DynamicToolLoader)    â”‚
â”‚  - åˆ›å»ºè®°å¿† (RedisChatHistory)     â”‚
â”‚  - åˆå§‹åŒ–æ™ºèƒ½ä½“ (create_agent)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UnifiedAgent.run(query)             â”‚
â”‚  - åˆ›å»ºæ‰§è¡Œå™¨ (AgentExecutor)       â”‚
â”‚  - æ·»åŠ è®°å¿†ç®¡ç†                      â”‚
â”‚  - æ‰§è¡ŒæŸ¥è¯¢                          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ReAct Loop                          â”‚
â”‚  1. Thought: åˆ†æé—®é¢˜                â”‚
â”‚  2. Action: é€‰æ‹©å·¥å…·                 â”‚
â”‚  3. Action Input: å‡†å¤‡å‚æ•°           â”‚
â”‚  4. Observation: æ‰§è¡Œå¹¶è·å–ç»“æœ      â”‚
â”‚  5. Final Answer: ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tool Execution                      â”‚
â”‚  - å†…ç½®å·¥å…· (Built-in)              â”‚
â”‚  - MCPå·¥å…· (MCP Stdio)              â”‚
â”‚  - APIå·¥å…· (REST API)               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response Formatting                 â”‚
â”‚  - æ­£å¸¸æ–‡æœ¬ (normal)                â”‚
â”‚  - Markdown (markdown)              â”‚
â”‚  - JSON (json)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Memory Storage (Redis)              â”‚
â”‚  - ä¿å­˜å¯¹è¯å†å²                      â”‚
â”‚  - è®¾ç½®TTL                           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å‡º   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·¥å…·è°ƒç”¨æµç¨‹

```
æ™ºèƒ½ä½“ â†’ Tool Router â†’ Tool Selector
                           â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                  â†“                   â†“
  Built-in Tool      API Tool           MCP Tool
        â†“                  â†“                   â†“
  ç›´æ¥æ‰§è¡Œ        HTTP Request      Stdio Communication
        â†“                  â†“                   â†“
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                      Tool Result
                           â†“
                       æ™ºèƒ½ä½“
```

## ğŸ”Œ é›†æˆç³»ç»Ÿ

### n8nå·¥ä½œæµé›†æˆ

**é€šä¿¡æ–¹å¼**: MCP (Model Context Protocol) Stdio

**é…ç½®**:
```json
{
  "type": "mcp_stdio",
  "name": "n8n_mcp_generator",
  "command": "docker",
  "args": ["exec", "n8n-mcp", "node", "dist/mcp/index.js"],
  "env": {
    "N8N_API_URL": "http://host.docker.internal:5678",
    "N8N_API_KEY": "your_api_key"
  }
}
```

**å¯ç”¨å·¥å…·**:
- `n8n_search_nodes`: æœç´¢n8nèŠ‚ç‚¹
- `n8n_get_node_info`: è·å–èŠ‚ç‚¹ä¿¡æ¯
- `n8n_generate_workflow`: ç”Ÿæˆå·¥ä½œæµ
- `n8n_validate_workflow`: éªŒè¯å·¥ä½œæµ
- `n8n_deploy_workflow`: éƒ¨ç½²å·¥ä½œæµ

### CrewAIé›†æˆ

**åŠŸèƒ½**:
- ç”Ÿæˆå›¢é˜Ÿé…ç½®
- å®šä¹‰è§’è‰²å’Œä»»åŠ¡
- è¿è¡Œå¤šæ™ºèƒ½ä½“åä½œ

**é…ç½®æ¨¡æ¿**:
```json
{
  "name": "ä¾›åº”é“¾ä¼˜åŒ–å›¢é˜Ÿ",
  "agents": [
    {
      "role": "æ•°æ®åˆ†æå¸ˆ",
      "goal": "åˆ†æä¾›åº”é“¾æ•°æ®",
      "backstory": "...",
      "tools": ["data_analyzer"]
    }
  ],
  "tasks": [...]
}
```

## ğŸ§ª æµ‹è¯•æ¶æ„

### æµ‹è¯•é‡‘å­—å¡”

```
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  E2E    â”‚  10%
                  â”‚  Tests  â”‚
                â”Œâ”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”
                â”‚ Integration â”‚  30%
                â”‚   Tests     â”‚
              â”Œâ”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”
              â”‚  Unit Tests     â”‚  60%
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµ‹è¯•å¥—ä»¶

1. **å•å…ƒæµ‹è¯•** (`tests/unit/`)
   - ç‹¬ç«‹ç»„ä»¶æµ‹è¯•
   - Mockå¤–éƒ¨ä¾èµ–
   - å¿«é€Ÿæ‰§è¡Œ

2. **é›†æˆæµ‹è¯•** (`tests/integration/`)
   - ç»„ä»¶åä½œæµ‹è¯•
   - çœŸå®ä¾èµ–
   - n8né›†æˆæµ‹è¯•

3. **ç»¼åˆæµ‹è¯•** (`tests/comprehensive/`)
   - æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
   - ç³»ç»Ÿé›†æˆæµ‹è¯•
   - ç«¯åˆ°ç«¯åœºæ™¯

4. **ä¾›åº”é“¾æµ‹è¯•** (`tests/supply_chain/`)
   - ä¸šåŠ¡æµç¨‹æµ‹è¯•
   - å·¥ä½œæµéªŒè¯

## ğŸ”§ æ‰©å±•ç‚¹

### 1. è‡ªå®šä¹‰æ™ºèƒ½ä½“

```python
from src.agents.unified.unified_agent import UnifiedAgent

class MyCustomAgent(UnifiedAgent):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        # è‡ªå®šä¹‰åˆå§‹åŒ–
    
    def custom_method(self):
        # è‡ªå®šä¹‰åŠŸèƒ½
        pass
```

### 2. è‡ªå®šä¹‰å·¥å…·

```python
from langchain.tools import BaseTool

class MyCustomTool(BaseTool):
    name = "my_custom_tool"
    description = "å·¥å…·æè¿°"
    
    def _run(self, query: str) -> str:
        # å®ç°å·¥å…·é€»è¾‘
        return result
```

æ³¨å†Œå·¥å…·:
```python
# src/agents/shared/tools.py
TOOL_CLASSES = {
    "my_custom_tool": MyCustomTool,
    # ...
}
```

### 3. è‡ªå®šä¹‰æç¤ºè¯

```yaml
# config/base/prompts.yaml
prompts:
  my_custom_prompt:
    name: "è‡ªå®šä¹‰æç¤ºè¯"
    template: |
      ä½ æ˜¯ä¸€ä¸ª...
```

### 4. è‡ªå®šä¹‰é…ç½®

```yaml
# config/base/my_config.yaml
my_service:
  enabled: true
  parameters:
    key: value
```

åŠ è½½é…ç½®:
```python
# src/config/config_loader.py
def get_my_config(self):
    return self.config.get("my_service", {})
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. ç¼“å­˜ç­–ç•¥
- Redisç¼“å­˜LLMå“åº”
- å·¥å…·ç»“æœç¼“å­˜
- é…ç½®ç¼“å­˜

### 2. å¹¶å‘å¤„ç†
- å¼‚æ­¥å·¥å…·è°ƒç”¨
- æ‰¹é‡è¯·æ±‚å¤„ç†
- è¿æ¥æ± ç®¡ç†

### 3. èµ„æºç®¡ç†
- ä¼šè¯TTLç®¡ç†
- å†…å­˜é™åˆ¶
- è¶…æ—¶æ§åˆ¶

### 4. ç›‘æ§æŒ‡æ ‡
- å“åº”æ—¶é—´
- å·¥å…·è°ƒç”¨æ¬¡æ•°
- é”™è¯¯ç‡
- å†…å­˜ä½¿ç”¨

## ğŸ”’ å®‰å…¨æ€§

### 1. APIå¯†é’¥ç®¡ç†
- ç¯å¢ƒå˜é‡å­˜å‚¨
- åŠ å¯†ä¼ è¾“
- å®šæœŸè½®æ¢

### 2. è¾“å…¥éªŒè¯
- å‚æ•°æ ¡éªŒ
- æ³¨å…¥é˜²æŠ¤
- å†…å®¹è¿‡æ»¤

### 3. è®¿é—®æ§åˆ¶
- ä¼šè¯éš”ç¦»
- æƒé™ç®¡ç†
- å®¡è®¡æ—¥å¿—

## ğŸ“ˆ å¯è§‚æµ‹æ€§

### 1. æ—¥å¿—ç³»ç»Ÿ
- ç»“æ„åŒ–æ—¥å¿—
- æ—¥å¿—çº§åˆ«
- æ—¥å¿—è½®è½¬

### 2. ç›‘æ§æŒ‡æ ‡
- ç³»ç»ŸæŒ‡æ ‡
- ä¸šåŠ¡æŒ‡æ ‡
- è‡ªå®šä¹‰æŒ‡æ ‡

### 3. è¿½è¸ªç³»ç»Ÿ
- è¯·æ±‚è¿½è¸ª
- å·¥å…·è°ƒç”¨è¿½è¸ª
- é”™è¯¯è¿½è¸ª

---

**æ¶æ„æŒç»­æ¼”è¿›ä¸­** | æœ€åæ›´æ–°ï¼š2025-10-28
